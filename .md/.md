# CLI quick reference



## Run endpoints (build Excel + JSON)
From project root:
- STAGE (discoveryTest)
```bash
npm run retrieval:staging_text -- --verbose true --debug true
```
- PROD (discover)
```bash
npm run retrieval:prod -- --verbose true --debug true
```

Outputs:
- Excel: `retrieval-automation/results/<endpoint>_<timestamp>.xlsx`
- JSON: `retrieval-automation/results/json/<endpoint>_<timestamp>.json`

## Compare (single workbook)
```bash
npm run retrieval:compare
```
Sheets in output:
- `PROD` (discover)
- `STAGE` (discoveryTest)
- `compare` (matched by _id; shows ranks/scores)

Rename tabs manually to your snapshot labels (e.g., `010825-PROD`, `080825-STAGE`).

## Quick run (1–N ad‑hoc questions)
STAGE example:
```bash
npm run retrieval:quick -- --endpoint discoveryTest --questions "When is next APICon New York happening?" "When is next apicon New York happening?"
```
Output: `retrieval-automation-quick/results/two_questions_discoveryTest_<timestamp>.xlsx`

PROD example:
```bash
npm run retrieval:quick -- --endpoint discover --questions "When is next APICon New York happening?"
```

## Merge quick results into latest STAGE JSON (on demand)
Only use this if a specific question failed in the main run and you want to add quick results into the latest discoveryTest JSON for comparison.

1) Ensure you have a quick JSON (run quick as above for discoveryTest).
2) Merge into the latest `retrieval-automation/results/json/discoveryTest_*.json`:
```bash
node retrieval-automation-quick/tools/merge_into_discoveryTest_json.js --questionId "BASTA! Spring" --language de --mode append
```
Options:
- `--questionId`: the Series name used in the main retrieval (required)
- `--language`: en|de|nl (required)
- `--mode`: append (default) or replace (replaces existing rows for this Series+Language)
- `--questionFilter`: exact question text to filter from quick JSON (optional)
- `--source`: path to a specific quick JSON (optional)
- `--target`: path to a specific discoveryTest JSON to merge into (optional)

Output: a new merged JSON alongside originals: `discoveryTest_<timestamp>_merged.json`.

## STAGE old vs STAGE new (stage mode)
Workflow:
1) Run STAGE (discoveryTest) to create today’s snapshot JSON:
```bash
npm run retrieval:staging_text -- --verbose true --debug true
```
2) After future changes, run STAGE again to create a newer snapshot (same command as above).
3) Generate a workbook comparing the two latest STAGE snapshots (newest = NEW, previous = OLD):
```bash
node retrieval-automation-compare/compare.js --mode stage --oldLabel 040925-STAGE --newLabel 100925-STAGE
```
Notes:
- The script auto-selects the two most recent `discoveryTest_*.json` files in `retrieval-automation/results/json/`.
- Adjust `--oldLabel`/`--newLabel` to the snapshot names you want on the sheets.
- Output sheets: `<oldLabel>`, `<newLabel>`, and `<oldLabel> VS <newLabel>`.

## Field meanings
- Rank: position in endpoint results for that question (0 = top).
- Score: retrieval score returned by endpoint.

## New Staging VS Production (01.08.2025)
```bash
node retrieval-automation-compare/compare.js
```
- rename the fields manually. 